import streamlit as st
import pandas as pd

# 1. í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="MBTI World Map", page_icon="ğŸŒ", layout="wide")

# 2. MBTI ê¸°ë³¸ ì„¤ëª… ë°ì´í„° (í•˜ë“œì½”ë”©)
mbti_descriptions = {
    "ISTJ": "í˜„ì‹¤ì£¼ì˜ì - ì±…ì„ê°ì´ ê°•í•˜ê³ , í˜„ì‹¤ì ì´ë©°, ë§¤ì‚¬ì— ì² ì €í•˜ê³  ë³´ìˆ˜ì ì…ë‹ˆë‹¤.",
    "ISFJ": "ìˆ˜í˜¸ì - ì°¨ë¶„í•˜ê³  í—Œì‹ ì ì´ë©°, ì„±ì‹¤í•˜ê³  ì˜¨í™”í•œ í˜‘ì¡°ìì…ë‹ˆë‹¤.",
    "INFJ": "ì˜¹í˜¸ì - ì¡°ìš©í•˜ê³  ì‹ ë¹„ë¡œìš°ë©°, ìƒ˜ì†ŸëŠ” ì˜ê°ìœ¼ë¡œ ì§€ì¹  ì¤„ ëª¨ë¥´ëŠ” ì´ìƒì£¼ì˜ìì…ë‹ˆë‹¤.",
    "INTJ": "ì „ëµê°€ - ìš©ì˜ì£¼ë„í•˜ê³  ë…ì°½ì ì´ë©°, ëª¨ë“  ì¼ì— ê³„íšì„ ì„¸ìš°ëŠ” ì „ëµê°€ì…ë‹ˆë‹¤.",
    "ISTP": "ì¥ì¸ - ê³¼ë¬µí•˜ê³  ë¶„ì„ì ì´ë©°, ì ì‘ë ¥ì´ ê°•í•˜ê³  ë„êµ¬ë¥¼ ì˜ ë‹¤ë£¨ëŠ” ë§ŒëŠ¥ ì¬ì£¼ê¾¼ì…ë‹ˆë‹¤.",
    "ISFP": "ëª¨í—˜ê°€ - ì˜¨í™”í•˜ê³  ê²¸ì†í•˜ë©°, ì‚¶ì˜ ì—¬ìœ ë¥¼ ë§Œë½í•˜ëŠ” ì§„ì •í•œ ì˜ˆìˆ ê°€ì…ë‹ˆë‹¤.",
    "INFP": "ì¤‘ì¬ì - ìƒëƒ¥í•˜ê³  ì´íƒ€ì ì´ë©°, ë‚­ë§Œì ì¸ ì´ìƒì„ ê¿ˆê¾¸ëŠ” ì‹œì¸ì…ë‹ˆë‹¤.",
    "INTP": "ë…¼ë¦¬ìˆ ì‚¬ - ì§€ì  í˜¸ê¸°ì‹¬ì´ ë†’ê³  ì ì¬ë ¥ê³¼ ê°€ëŠ¥ì„±ì„ íƒêµ¬í•˜ëŠ” ì‚¬ìƒ‰ê°€ì…ë‹ˆë‹¤.",
    "ESTP": "ì‚¬ì—…ê°€ - íƒ€í˜‘ì„ ëª¨ë¥´ê³ , ìœ„í—˜ì„ ì¦ê¸°ë©°, ëª¨í—˜ì„ ì¦ê¸°ëŠ” ì˜ë¦¬í•œ ì‚¬ì—…ê°€ì…ë‹ˆë‹¤.",
    "ESFP": "ì—°ì˜ˆì¸ - ì‚¬êµì ì´ê³  í™œë™ì ì´ë©°, ìˆ˜ìš©ì ì´ê³  ë‚™ì²œì ì¸ ë§ŒëŠ¥ ì—”í„°í…Œì´ë„ˆì…ë‹ˆë‹¤.",
    "ENFP": "í™œë™ê°€ - ì—´ì •ì ì´ê³  ì°½ì˜ì ì´ë©°, ê¸ì •ì ì¸ ì—ë„ˆì§€ê°€ ë„˜ì¹˜ëŠ” ì¬ê¸°ë°œë„í•œ í™œë™ê°€ì…ë‹ˆë‹¤.",
    "ENTP": "ë³€ë¡ ê°€ - ë°•í•™ë‹¤ì‹í•˜ê³  ë…ì°½ì ì´ë©°, ëŠì„ì—†ì´ ìƒˆë¡œìš´ ì‹œë„ë¥¼ í•˜ëŠ” ë…¼ìŸì„ ì¦ê¸°ëŠ” ë³€ë¡ ê°€ì…ë‹ˆë‹¤.",
    "ESTJ": "ê²½ì˜ì - êµ¬ì²´ì ì´ê³  í˜„ì‹¤ì ì´ë©°, ì‚¬ì‹¤ì ì´ê³  í™œë™ì„ ì¡°ì§í™”í•˜ëŠ” ì§€ë„ìì…ë‹ˆë‹¤.",
    "ESFJ": "ì§‘ì •ê´€ - ì‚¬êµì ì´ê³  ì¹œì ˆí•˜ë©°, íƒ€ì¸ì— ëŒ€í•œ ê´€ì‹¬ê³¼ ë°°ë ¤ê°€ ë„˜ì¹˜ëŠ” ì¸ê¸°ìŸì´ì…ë‹ˆë‹¤.",
    "ENFJ": "ì„ ë„ì - ì¹´ë¦¬ìŠ¤ë§ˆì™€ ì¶©ë§Œí•œ ì—´ì •ì„ ì§€ë‹Œ íƒ€ê³ ë‚œ ë¦¬ë”ì…ë‹ˆë‹¤.",
    "ENTJ": "í†µì†”ì - ëŒ€ë‹´í•˜ê³  ìƒìƒë ¥ì´ í’ë¶€í•˜ë©°, ê°•ë ¥í•œ ì˜ì§€ë¡œ ë¬´ë¦¬(ì¡°ì§)ë¥¼ ì´ë„ëŠ” ì§€ë„ìì…ë‹ˆë‹¤."
}

# 3. ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
@st.cache_data
def load_data():
    try:
        # íŒŒì¼ì´ ê°™ì€ ê²½ë¡œì— ìˆë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.
        df = pd.read_csv('countriesMBTI_16types.csv')
        return df
    except FileNotFoundError:
        return None

# --- ë©”ì¸ ì•± ë¡œì§ ---

def main():
    st.title("ğŸŒ ë‹¹ì‹ ì˜ MBTIëŠ” ì–´ë””ì„œ ê°€ì¥ ì¸ê¸° ìˆì„ê¹Œìš”?")
    st.markdown("ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¹ì‹ ì˜ ì„±í–¥ê³¼ ê°€ì¥ ì˜ ì–´ìš¸ë¦¬ëŠ” êµ­ê°€ë¥¼ ì°¾ì•„ë“œë¦½ë‹ˆë‹¤.")
    
    st.divider() # êµ¬ë¶„ì„ 

    # ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    df = load_data()
    
    if df is None:
        st.error("ë°ì´í„° íŒŒì¼(countriesMBTI_16types.csv)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.")
        return

    # MBTI ë¦¬ìŠ¤íŠ¸ ìƒì„±
    mbti_list = list(mbti_descriptions.keys())
    
    # ì‚¬ì´ë“œë°” í˜¹ì€ ë©”ì¸ ìƒë‹¨ì—ì„œ ì„ íƒ
    # ì´ˆê¸° ìƒíƒœ(index=None)ì„ ì§€ì›í•˜ì—¬ 'ì„ íƒ ì•ˆ í•¨' ìƒíƒœë¥¼ ë§Œë“­ë‹ˆë‹¤.
    selected_mbti = st.selectbox(
        "ë‹¹ì‹ ì˜ MBTIë¥¼ ì„ íƒí•´ì£¼ì„¸ìš” ğŸ‘‡",
        options=mbti_list,
        index=None, 
        placeholder="MBTIë¥¼ ì„ íƒí•˜ì„¸ìš”..."
    )

    # 4. ì„ íƒ ì—¬ë¶€ì— ë”°ë¥¸ í™”ë©´ ë¶„ê¸°
    if selected_mbti is None:
        # ì•„ë¬´ê²ƒë„ ì„ íƒë˜ì§€ ì•Šì•˜ì„ ë•Œ
        st.info("ğŸ‘‹ ìœ„ ë©”ë‰´ì—ì„œ ìì‹ ì˜ MBTI ìœ í˜•ì„ ì„ íƒí•˜ë©´ ë¶„ì„ ê²°ê³¼ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤!")
        
        # ê°„ë‹¨í•œ ì´ë¯¸ì§€ë‚˜ í…ìŠ¤íŠ¸ë¡œ ê¾¸ë°ˆ (ì„ íƒ ìœ ë„)
        st.markdown("""
        ### â“ ë¬´ì—‡ì„ ì•Œ ìˆ˜ ìˆë‚˜ìš”?
        - ë‚˜ì˜ **ì„±ê²© ìœ í˜• ìš”ì•½**
        - ë‚´ ì„±í–¥ì´ **ê°€ì¥ í”í•œ êµ­ê°€**
        - ì „ ì„¸ê³„ **í†µê³„ ë°ì´í„° ì‹œê°í™”**
        """)
        
    else:
        # MBTIê°€ ì„ íƒë˜ì—ˆì„ ë•Œ
        
        # --- A. ì„¤ëª… ì„¹ì…˜ ---
        st.header(f"âœ¨ ë‹¹ì‹ ì€ [{selected_mbti}] ìœ í˜•ì´êµ°ìš”!")
        st.success(mbti_descriptions[selected_mbti])
        
        # --- B. ë°ì´í„° ë¶„ì„ ì„¹ì…˜ ---
        # í•´ë‹¹ MBTI ì»¬ëŸ¼ì˜ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
        sorted_df = df.sort_values(by=selected_mbti, ascending=False).head(10)
        
        # 1ìœ„ êµ­ê°€ ì •ë³´ ì¶”ì¶œ
        top_country = sorted_df.iloc[0]['Country']
        top_value = sorted_df.iloc[0][selected_mbti]
        
        # ë°ì´í„° ê°’ì€ ë¹„ìœ¨(0.0~1.0)ë¡œ ì¶”ì •ë˜ë¯€ë¡œ í¼ì„¼íŠ¸ë¡œ ë³€í™˜
        percentage = top_value * 100 

        # --- C. ë§ì¶¤í˜• ë©˜íŠ¸ ë° í†µê³„ ---
        st.subheader("ğŸ“Š ë°ì´í„° ë¶„ì„ ê²°ê³¼")
        
        # ì»¬ëŸ¼ì„ ë‚˜ëˆ„ì–´ ì™¼ìª½ì—” í…ìŠ¤íŠ¸, ì˜¤ë¥¸ìª½ì—” ì°¨íŠ¸ ë°°ì¹˜
        col1, col2 = st.columns([1, 1.5])
        
        with col1:
            st.markdown(f"""
            ë‹¹ì‹ ì˜ ì„±í–¥ì¸ **{selected_mbti}**ëŠ” ì „ ì„¸ê³„ì ìœ¼ë¡œ ë‹¤ì–‘í•œ ë¶„í¬ë¥¼ ë³´ì…ë‹ˆë‹¤.
            
            ë°ì´í„°ì— ë”°ë¥´ë©´, ë‹¹ì‹ ê³¼ ê°™ì€ ìœ í˜•ì˜ ì‚¬ëŒë“¤ì´ 
            ê°€ì¥ ë§ì´ ë¶„í¬í•œ êµ­ê°€ëŠ” **ğŸŒ {top_country}** ì…ë‹ˆë‹¤.
            
            ì´ êµ­ê°€ì—ì„œëŠ” ì „ì²´ ì¸êµ¬ì˜ ì•½ **{percentage:.1f}%**ê°€ 
            ë‹¹ì‹ ê³¼ ê°™ì€ ì„±í–¥ì„ ê°€ì§€ê³  ìˆì–´ìš”!
            
            > *"{top_country}ë¡œ ì—¬í–‰ì„ ë– ë‚œë‹¤ë©´, ë§ˆìŒì´ ì˜ ë§ëŠ” ì¹œêµ¬ë“¤ì„ ë” ì‰½ê²Œ ë§Œë‚  ìˆ˜ ìˆì§€ ì•Šì„ê¹Œìš”?"*
            """)
            
            # ì „ì²´ í‰ê·  ê³„ì‚°
            avg_value = df[selected_mbti].mean() * 100
            st.caption(f"ì „ ì„¸ê³„ {selected_mbti} í‰ê·  ë¹„ìœ¨: {avg_value:.1f}%")

        with col2:
            st.markdown(f"**ğŸŒ {selected_mbti} ë¹„ìœ¨ì´ ê°€ì¥ ë†’ì€ êµ­ê°€ Top 10**")
            
            # ì°¨íŠ¸ë¥¼ ìœ„í•´ ë°ì´í„° ê°€ê³µ (êµ­ê°€ë¥¼ ì¸ë±ìŠ¤ë¡œ ì„¤ì •)
            chart_data = sorted_df.set_index('Country')[selected_mbti]
            st.bar_chart(chart_data, color="#4A90E2") # íŒŒë€ìƒ‰ ê³„ì—´

if __name__ == "__main__":
    main()
